{% extends 'base.html' %}
{% load markup %}
{% load my_tags %}

{% block title %}
  Tomo &mdash; {{ problem_set.course.name }} &mdash; {{ problem_set.title }}
{% endblock %}

{% block breadcrumbs %}
  <li><a href="{% url homepage %}">Začetna stran</a> <span class="divider">/</span></li>
  <li><a href="{% url course problem_set.course.id %}">{{ problem_set.course.name }}</a> <span class="divider">/</span></li>
  <li class="active">{{ problem_set.title }}</li>
{% endblock %}

{% block heading %}
  {{ problem_set.title }}
{% endblock %}

{% block header %}
    {{ problem_set.description|markdown:"mathjax" }}

    {% if user.is_authenticated %}
      <a href="{% url download_problem_set problem_set.id %}"><button class="btn primary">Prenesi naloge</button></a>&nbsp;
      {% if request.user.is_staff %}
      <a href="{% url view_statistics problem_set.id %}"><button class="btn">Poglej statistiko</button></a>&nbsp;
      <a href=""><button class="btn">Uredi datoteke</button></a>&nbsp;
      <a href="{% url admin:problem_problemset_change problem_set.id %}"><button class="btn">Uredi sklop</button></a>&nbsp;
      <a href="{% url admin:problem_problemset_delete problem_set.id %}"><button class="btn danger">Pobriši sklop</button></a>
      {% endif %}
    {% else %}
      <div id="modal-from-dom" class="modal hide fade">
        <div class="modal-header">
          <a href="#" class="close">&times;</a>
          <h3>Za reševanje se najprej prijavite.</h3>
        </div>
        <div class="modal-body">
          <p>
            Če se ne morete prijaviti, lahko naloge rešujete z začasnimi datotekami.
            V tem primeru se vaše rešitve <strong>ne bodo shranile na strežnik</strong>.
            Ko se boste lahko spet prijavili, boste naloge morali ponovno prenesti ter vanje prepisati začasne rešitve.
          </p>
        </div>
        <div class="modal-footer">
          <a href="{% url download_problem_set problem_set.id %}" class="btn secondary">Prenesite začasne datoteke</a>
        </div>
      </div>

      <button data-controls-modal="modal-from-dom" data-backdrop="true" data-keyboard="true" class="btn primary">Prenesi naloge</button>
    {% endif %}

    {% if not request.user.is_staff %}
    <span class='help-block'>
      Z zgornjim gumbom na svoj računalnik prenesete arhiv, ki vsebuje datoteke z nalogami.<br />
      Navodila za reševanje so zapisana v datotekah.
    </span>
    {% endif %}
{% endblock %}

{% block content %}
    {% for problem in problems.all %}
        {% include 'inline/problem.html' %}
        <div class='row'>
          <div class='span12 offset1'>
            {{ problem.description|markdown:"mathjax" }}
          </div>
        </div>
        {% for part in problem.parts.all %}
          {% with attempts|get:part.id as attempt %}
            {% include 'inline/part.html' %}
          {% endwith %}
        {% endfor %}
      <hr />
    {% endfor %}

    {% if request.user.is_staff %}
    <div class='row'>
      <div class='offset1'>
      <h3>Dodaj nalogo</h3>
<form method="post" action="{% url create %}" class="form-stacked">
{% csrf_token %}
        <fieldset>
          <input type="hidden" name="problem_set" value="{{ problem_set.id }}" />
          <div class="clearfix">
            <label for="xlInput3">Naslov</label>
            <div class="input">
              <input size="30" type="text" name="title" />
            </div>
          </div><!-- /clearfix -->
          <div class="clearfix">
            <label for="stackedSelect">Jezik</label>
            <div class="input">
  <select name="language" id="language">
        {% for language in languages.all %}
          <option value="{{ language.id }}" {% if language.id == default_language.id %}selected{%endif %}>{{ language.name }}</option>
        {% endfor %}
        </select>
                  </div>
          </div><!-- /clearfix -->
          <button type="submit" class="btn primary">Dodaj</button>
        </fieldset>
      </form>

      </div>
    </div>
    {% endif %}
{% endblock %}

