{% extends 'base.html' %}
{% load my_tags %}

{% block title %}
  Tomo &mdash;
  {{ problem_set.course.name }} &mdash;
  {{ problem_set.title }}
{% endblock %}

{% block content %}
  <h1>{{ problem_set.title }}</h1>

  {% if request.user.is_staff %}
  <ul class="nav nav-tabs">
    <li>
      <a href="{% url problem_set problem_set.id %}">Naloga</a>
    </li>
    <li class="active">
      <a href="{% url view_statistics problem_set.id %}">Statistika</a>
    </li>
  </ul>
  {% endif %}


  {% for problem in problems.all %}
  <h3>
    Naloga {{ forloop.counter }}
    {% if problem.title %} &mdash; {{ problem.title }}{% endif %}
  </h3>

  <table class="table table-striped table-bordered table-condensed">
    <thead>
      <tr>
        <th>&nbsp;</th>
        <th>Ime in priimek</th>
        {% for part in problem.parts.all %}
        {% with success|get:part.id as part_success %}
        <th>{{ forloop.counter }}) <span class="label label-success">{{ part_success.correct }}</span> / <span class="label label-important">{{ part_success.incorrect }}</span></th>
        {% endwith %}
        {% endfor %}
      </tr>
    </thead>

    <tbody>
      {% with attempts|get:problem.id as problem_attempts %}
      {% for user in users %}
      {% if user.id in problem_attempts %}
      <tr>
        <td><a class="icon-download" href="{% url student_archive_download problem.id user.id %}"></a></td>
        <td>{{ user.get_full_name }}</td>
        {% with problem_attempts|get:user.id as user_attempts %}
        {% for part in problem.parts.all %}
        {% with user_attempts|get:part.id as attempt %}
          <td>
            {% if attempt %}
              {% include 'modal/view_solution.html' %}
              <a data-toggle="modal" href="#solutions-{{ problem.id }}-{{ part.id }}-{{ user.id }}" class="icon-{% if attempt.correct %}ok{% else %}remove{% endif %}">
              </a>
            {% else %}
              &nbsp;
            {% endif %}
          </td>
        {% endwith %}
        {% endfor %}
        {% endwith %}
      </tr>
      {% endif %}
      {% endfor %}
      {% endwith %}
    </tbody>
  </table>
  {% endfor %}
{% endblock %}



